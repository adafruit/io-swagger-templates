'use strict';

const util = require('util'),
      xml = require('xml'),
      {{#operations}}model = require('../models/{{modelname}}');{{#operation}}

module.exports.{{operationId}} = function {{operationId}}(req, res, next) {
{{#hasParams}}

  const {{/hasParams}}{{#allParams}}{{paramName}} = req.swagger.params['{{baseName}}'].value{{#hasMore}},
      {{/hasMore}}{{/allParams}}{{#hasParams}};
{{/hasParams}}

  model.{{operationId}}({{#allParams}}{{paramName}}{{#hasMore}}, {{/hasMore}}{{/allParams}})
    .then(function(data) {
      res.format({
        'application/json': function() {
          res.json(data);
        },
        'text/csv': function() {
          res.csv(data);
        },
        'application/xml': function() {
          res.set('Content-Type', 'text/xml');
          res.send(xml(data));
        },
        'text/html': function() {
          res.set('Content-Type', 'application/json');
          res.json(data);
        },
        'default': function() {
          res.set('Content-Type', 'application/json');
          res.json(data);
        }
      });
    }).
    catch(function(err) {
      res.writeHead(500);
      res.end();
    });

};
{{/operation}}{{/operations}}
